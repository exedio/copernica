<?xml version="1.0"?>

<project name="cope.persistence" default="all" basedir=".">

	<taskdef
			resource="net/sf/antcontrib/antcontrib.properties"
			classpath="../lib/ant-contrib.jar" />

	<target name="properties">
		<property file="../local.properties" />
	</target>

	<target name="jspm.taskdef">
		<taskdef name="jspm"
					classname="com.exedio.jspm.AntTask"
					classpath="../jspm/build/classes" />
	</target>
	
	<macrodef name="ljavac">
		<attribute name="srcdir" />
		<attribute name="destdir" />
		<element name="classpath" optional="true" implicit="true" />
		<sequential>
			<!--<echo message="local compile @{srcdir} to @{destdir}" />-->
			<javac srcdir="@{srcdir}"
					 destdir="@{destdir}"
					 deprecation="on"
					 debug="on"
					 optimize="off">
				<classpath />
			</javac>
		</sequential>
	</macrodef>
	
	<macrodef name="foreachdb">
		<attribute name="message" />
		<element name="body" optional="false" />
		<sequential>
			<for param="db.file">
				<path>
					<fileset dir="${basedir}" includes="*.test.cope.properties" />
				</path>
				<sequential>
					<basename file="@{db.file}" property="@{db.file}.db" suffix=".test.cope.properties" />
					<!-- this is a dummy loop to create the attribute @{db} -->
					<for param="db" list="${@{db.file}.db}">
						<sequential>
							<echo message="@{message} @{db}" />
							<property file="@{db.file}" prefix="@{db.file}." />
							<!-- this is a dummy loop to create the attribute @{db.driver} -->
							<for param="db.driver" list="${@{db.file}.x-build.driver}">
								<sequential>
									<body />
								</sequential>
							</for>
						</sequential>
					</for>
				</sequential>
			</for>
		</sequential>
	</macrodef>
	
	<target name="databases.property">
		<mkdir dir="lib/build" />
		<delete file="lib/build/databases.tmp" />
		<foreachdb message="Found">
			<body>
				<echo message=" @{db}" file="lib/build/databases.tmp" append="true" />
			</body>
		</foreachdb>
		<loadfile property="databases" srcFile="lib/build/databases.tmp" />
		<echo message="Found Databases:${databases}" />
		<delete file="lib/build/databases.tmp" />
	</target>
	
	<target name="lib.compile.mkdir">
		<mkdir dir="lib/build/classes" />
		<!-- test for cruisecontrol -->
		<echo message="test message level error"   level="error" />
		<echo message="test message level warning" level="warning" />
		<echo message="test message level info"    level="info" />
		<echo message="test message level verbose" level="verbose" />
		<echo message="test message level debug"   level="debug" />
	</target>

	<target name="dsmf.compile" depends="lib.compile.mkdir">
		<ljavac srcdir="dsmf/src" destdir="lib/build/classes" />
	</target>
	
	<target name="lib.core.compile" depends="lib.compile.mkdir, dsmf.compile">
		<ljavac srcdir="lib/src" destdir="lib/build/classes">
			<classpath>
				<pathelement location="../lib/pcj.jar" />
			</classpath>
		</ljavac>
	</target>
	
	<!-- TODO make database specific compiles via a loop -->
	<target name="lib.hsqldb.compile" depends="lib.compile.mkdir, lib.core.compile">
		<ljavac srcdir="lib/hsqldbsrc" destdir="lib/build/classes">
			<classpath>
				<pathelement location="../lib/hsqldb.jar" />
			</classpath>
		</ljavac>
	</target>

	<target name="lib.oracle.compile" depends="lib.compile.mkdir, lib.core.compile">
		<if>
			<or>
				<available file="../lib/classes12.jar" />
				<available file="../lib/ojdbc14.jar" />
			</or>
			<then>
				<ljavac srcdir="lib/oraclesrc" destdir="lib/build/classes">
					<classpath>
						<pathelement location="../lib/pcj.jar" />
						<pathelement location="../lib/classes12.jar" />
						<pathelement location="../lib/ojdbc14.jar" />
					</classpath>
				</ljavac>
			</then>
			<else>
				<echo message="skipping oracle driver" />
			</else>
		</if>
	</target>

	<target name="lib.mysql.compile" depends="lib.compile.mkdir, lib.core.compile">
		<if>
			<available file="../lib/mysql-connector-java-bin.jar" />
			<then>
				<ljavac srcdir="lib/mysqlsrc" destdir="lib/build/classes">
					<classpath>
						<pathelement location="../lib/pcj.jar" />
						<pathelement location="../lib/mysql-connector-java-bin.jar" />
					</classpath>
				</ljavac>
			</then>
			<else>
				<echo message="skipping mysql driver" />
			</else>
		</if>
	</target>

	<target name="lib.pattern.compile" depends="lib.compile.mkdir, lib.core.compile">
		<ljavac srcdir="lib/patternsrc" destdir="lib/build/classes" />
	</target>
	
	<target name="lib.servlet.compile" depends="lib.compile.mkdir, lib.core.compile">
		<ljavac srcdir="lib/servletsrc" destdir="lib/build/classes">
			<classpath>
				<pathelement location="../tomcat/common/lib/servlet-api.jar" />
			</classpath>
		</ljavac>
	</target>
	
	<target name="lib.junit.compile" depends="lib.compile.mkdir, lib.core.compile">
		<ljavac srcdir="lib/junitsrc" destdir="lib/build/classes">
			<classpath>
				<pathelement location="../lib/junit.jar" />
			</classpath>
		</ljavac>
	</target>
	
	<target name="lib.compile"
				depends="lib.core.compile,
							lib.hsqldb.compile,
							lib.oracle.compile,
							lib.mysql.compile,
							lib.pattern.compile,
							lib.servlet.compile,
							lib.junit.compile" />
	
	<target name="instrument.compile" depends="lib.compile">
		<mkdir dir="instrument/build/classes" />
		<ljavac srcdir="instrument/src" destdir="instrument/build/classes">
			<classpath>
				<pathelement location="lib/build/classes" />
			</classpath>
		</ljavac>
	</target>
	
	<target name="copernica.compile" depends="lib.compile, copernica.jspm">
		<mkdir dir="copernica/build/classes" />
		<ljavac srcdir="copernica/src" destdir="copernica/build/classes">
			<classpath>
				<pathelement location="lib/build/classes" />
				<pathelement location="../cops/build/classes" />
				<pathelement location="../tomcat/common/lib/servlet-api.jar" />
				<pathelement location="../tomcat/server/lib/commons-fileupload-1.0.jar" />
			</classpath>
		</ljavac>
		<copy todir="copernica/build/classes">
			<fileset dir="copernica/src">
				<include name="**/*.css" />
				<include name="**/*.js" />
				<include name="**/*.png" />
			</fileset>
		</copy>
	</target>
	
	<target name="compile"
				depends="lib.compile,
							instrument.compile,
							copernica.compile, copernica.test.compile" />
	
	<target name="lib.jar" depends="databases.property, lib.compile">
		<jar jarfile="lib/build/exedio-cope.jar" basedir="lib/build/classes">
			<manifest>
				<attribute name="Specification-Title" value="exedio cope" />
				<attribute name="Specification-Version" value="cruisecontrol ${label} ${cvstimestamp}" />
				<attribute name="Specification-Vendor" value="exedio GmbH" />
				<attribute name="Implementation-Title" value="exedio cope" />
				<attribute name="Implementation-Version" value="cruisecontrol ${label} ${cvstimestamp} tested with${databases}" />
				<attribute name="Implementation-Vendor" value="exedio GmbH" />
			</manifest>
		</jar>
	</target>
	
	<target name="lib.test.jar" depends="dsmf.test.compile, lib.test.compile">
		<jar jarfile="lib/build/exedio-cope-test.jar">
			<fileset dir="dsmf/build/testclasses" />
			<fileset dir="lib/build/testclasses" />
			<fileset dir="lib/build/testmodelclasses" />
			<manifest>
				<attribute name="Specification-Title" value="exedio cope test" />
				<attribute name="Specification-Version" value="cruisecontrol ${label} ${cvstimestamp}" />
				<attribute name="Specification-Vendor" value="exedio GmbH" />
				<attribute name="Implementation-Title" value="exedio cope test" />
				<attribute name="Implementation-Version" value="cruisecontrol ${label} ${cvstimestamp}" />
				<attribute name="Implementation-Vendor" value="exedio GmbH" />
			</manifest>
		</jar>
	</target>
	
	<target name="instrument.jar" depends="instrument.compile">
		<jar jarfile="instrument/build/exedio-cope-instrument.jar" basedir="instrument/build/classes">
			<manifest>
				<attribute name="Specification-Title" value="exedio cope instrumentor" />
				<attribute name="Specification-Version" value="cruisecontrol ${label} ${cvstimestamp}" />
				<attribute name="Specification-Vendor" value="exedio GmbH" />
				<attribute name="Implementation-Title" value="exedio cope instrumentor" />
				<attribute name="Implementation-Version" value="cruisecontrol ${label} ${cvstimestamp}" />
				<attribute name="Implementation-Vendor" value="exedio GmbH" />
			</manifest>
		</jar>
	</target>
	
	<target name="copernica.jar" depends="copernica.compile">
		<jar jarfile="copernica/build/exedio-copernica.jar" basedir="copernica/build/classes">
			<manifest>
				<attribute name="Specification-Title" value="exedio copernica" />
				<attribute name="Specification-Version" value="cruisecontrol ${label} ${cvstimestamp}" />
				<attribute name="Specification-Vendor" value="exedio GmbH" />
				<attribute name="Implementation-Title" value="exedio copernica" />
				<attribute name="Implementation-Version" value="cruisecontrol ${label} ${cvstimestamp}" />
				<attribute name="Implementation-Vendor" value="exedio GmbH" />
			</manifest>
		</jar>
	</target>
	
	<target name="jar" depends="lib.jar, lib.test.jar, instrument.jar, copernica.jar" />
	
	<target name="dsmf.test.compile" depends="dsmf.compile, lib.compile">
		<mkdir dir="dsmf/build/testclasses" />
		<ljavac srcdir="dsmf/testsrc" destdir="dsmf/build/testclasses">
			<classpath>
				<pathelement location="lib/build/classes" />
				<pathelement location="../lib/junit.jar" />
			</classpath>
		</ljavac>
	</target>
	
	<target name="dsmf.test.run" depends="dsmf.test.compile">
		<foreachdb message="Testing">
			<body>
				<java classname="junit.textui.TestRunner" taskname="junit @{db}" fork="yes" failonerror="yes">
					<classpath>
						<pathelement location="lib/build/classes" />
						<pathelement location="dsmf/build/testclasses" />
						<pathelement location="../lib/junit.jar" />
						<pathelement location="../lib/@{db.driver}" />
					</classpath>
					<arg value="com.exedio.dsmf.PackageTest" />
					<sysproperty key="com.exedio.cope.properties" file="@{db.file}" />
				</java>
			</body>
		</foreachdb>
	</target>
	
	<target name="dsmf.test" depends="dsmf.test.run" />
	
	<target name="instrument.taskdef" depends="lib.compile, instrument.compile">
		<taskdef name="instrument" classname="com.exedio.cope.instrument.AntTask">
			<classpath>
				<pathelement location="../lib/pcj.jar" />
				<pathelement location="lib/build/classes" />
				<pathelement location="instrument/build/classes" />
			</classpath>
		</taskdef>
	</target>
	
	<target name="lib.testmodel.instrument" depends="instrument.taskdef">
		<instrument verbose="false">
			<filelist dir="lib/testmodelsrc/com/exedio/cope/testmodel" files="
				ItemWithSingleUnique.java,
				ItemWithSingleUniqueReadOnly.java,
				ItemWithSingleUniqueNotNull.java,
				ItemWithDoubleUnique.java,
				EmptyItem.java,
				EmptyItem2.java,
				AttributeEmptyItem.java,
				AttributeItem.java,
				StringItem.java,
				HashItem.java,
				MD5Item.java,
				MediaItem.java,
				SumItem.java,
				VectorItem.java,
				PointerItem.java,
				PointerTargetItem.java,
				QualifiedEmptyQualifier.java,
				QualifiedStringQualifier.java,
				QualifiedIntegerEnumQualifier.java,
				QualifiedItem.java,
				Super.java,
				FirstSub.java,
				SecondSub.java,
				CollisionItem1.java,
				CollisionItem2.java" />
			<filelist dir="lib/testsrc/com/exedio/cope" files="
				DataItem.java,
				DeleteItem.java,
				DeleteOtherItem.java,
				NameLongNameLongNameLongNameLongNameLongNameLongItem.java,
				NameCollisionlooooooooooooooooooooooooooooooooooooooooongaItem.java,
				NameCollisionlooooooooooooooooooooooooooooooooooooooooongbItem.java,
				CacheIsolationItem.java" />
		</instrument>
	</target>
	
	<target name="lib.testmodel.compile" depends="lib.testmodel.instrument">
		<mkdir dir="lib/build/testmodelclasses" />
		<ljavac srcdir="lib/testmodelsrc" destdir="lib/build/testmodelclasses">
			<classpath>
				<pathelement location="lib/build/classes" />
				<pathelement location="../tomcat/common/lib/servlet-api.jar" />
			</classpath>
		</ljavac>
	</target>
	
	<target name="lib.test.compile"
				depends="lib.testmodel.compile, lib.junit.compile">
		<mkdir dir="lib/build/testclasses" />
		<ljavac srcdir="lib/testsrc" destdir="lib/build/testclasses">
			<classpath>
				<pathelement location="lib/build/classes" />
				<pathelement location="lib/build/testmodelclasses" />
				<pathelement location="../lib/junit.jar" />
			</classpath>
		</ljavac>
	</target>
	
	<target name="lib.test.run" depends="lib.test.compile">
		<foreachdb message="Testing">
			<body>
				<mkdir dir="lib/build/test.@{db}/data" />
				<copy file="@{db.file}"
						tofile="lib/build/test.@{db}/cope.properties">
					<filterset>
						<filter token="DATADIR_PATH" value="lib/build/test.@{db}/data" />
					</filterset>
				</copy>
				<!--
				<nbjpdastart addressproperty="jpda.address" name="cope" transport="dt_socket">
					<classpath>
						<pathelement location="lib/build/classes" />
						<pathelement location="lib/build/testmodelclasses" />
						<pathelement location="lib/build/testclasses" />
						<pathelement location="../lib/junit.jar" />
						<pathelement location="../lib/pcj.jar" />
						<pathelement location="../lib/@{db.driver}" />
					</classpath>
				</nbjpdastart>
				-->
				<java classname="junit.textui.TestRunner" taskname="junit @{db}" fork="yes" failonerror="yes">
					<classpath>
						<pathelement location="lib/build/classes" />
						<pathelement location="lib/build/testmodelclasses" />
						<pathelement location="lib/build/testclasses" />
						<pathelement location="../lib/junit.jar" />
						<pathelement location="../lib/pcj.jar" />
						<pathelement location="../lib/@{db.driver}" />
					</classpath>
					<arg value="com.exedio.cope.PackageTest" />
					<sysproperty key="com.exedio.cope.properties" file="lib/build/test.@{db}/cope.properties" />
					<!--
					<jvmarg value="-Xdebug"/>
					<jvmarg value="-Xnoagent"/>
					<jvmarg value="-Djava.compiler=none"/>
					<jvmarg value="-Xrunjdwp:transport=dt_socket,address=${jpda.address}"/>
					-->
				</java>
			</body>
		</foreachdb>
	</target>
	
	<target name="lib.test" depends="lib.test.run" />

	<target name="lib.test.teardown" depends="lib.compile, lib.test.compile">
		<foreachdb message="Tearing down">
			<body>
				<mkdir dir="lib/build/teardown.@{db}/data" />
				<copy file="@{db.file}"
						tofile="lib/build/teardown.@{db}/cope.properties">
					<filterset>
						<filter token="DATADIR_PATH"
								  value="lib/build/teardown.@{db}/data" />
					</filterset>
				</copy>
				<java classname="com.exedio.cope.Main" taskname="tear down @{db}"
						fork="yes" failonerror="yes">
					<classpath>
						<pathelement location="lib/build/classes" />
						<pathelement location="lib/build/testmodelclasses" />
						<pathelement location="lib/build/testclasses" />
						<pathelement location="../lib/pcj.jar" />
						<pathelement location="../lib/@{db.driver}" />
					</classpath>
					<sysproperty key="com.exedio.cope.properties"
									 file="lib/build/teardown.@{db}/cope.properties" />
				</java>
			</body>
		</foreachdb>
	</target>

	<target name="teardown" depends="lib.test.teardown" />


	<target name="instrument.test.instrument" depends="instrument.taskdef">
		<instrument verbose="false">
			<filelist dir="instrument/testsrc/com/exedio/cope/instrument/testmodel" files="
				Standard.java,
				TypePrivate.java,
				TypeNone.java,
				QualifiedName.java,
				Qualified.java" />
		</instrument>
	</target>
	
	<target name="instrument.test.compile" depends="instrument.test.instrument, lib.compile, instrument.compile">
		<mkdir dir="instrument/build/testclasses" />
		<ljavac srcdir="instrument/testsrc" destdir="instrument/build/testclasses">
			<classpath>
				<pathelement location="lib/build/classes" />
				<pathelement location="instrument/build/classes" />
				<pathelement location="../lib/junit.jar" />
			</classpath>
		</ljavac>
		<copy
			file="instrument/testsrc/com/exedio/cope/instrument/Example.java"
			todir="instrument/build/testclasses/com/exedio/cope/instrument" />
	</target>
	
	<target name="instrument.test.run"
				depends="lib.compile, instrument.compile, instrument.test.compile">
		<java classname="junit.textui.TestRunner" taskname="junit" fork="yes" failonerror="yes">
			<classpath>
				<pathelement location="lib/build/classes" />
				<pathelement location="instrument/build/classes" />
				<pathelement location="instrument/build/testclasses" />
				<pathelement location="../lib/junit.jar" />
				<pathelement location="../lib/pcj.jar" />
			</classpath>
			<arg value="com.exedio.cope.instrument.PackageTest" />
		</java>
	</target>
	
	<target name="instrument.test" depends="instrument.test.run" />
	
	<target name="test" depends="dsmf.test, lib.test, instrument.test" />
	
	
	<target name="copernica.jspm" depends="jspm.taskdef">
		<jspm>
			<fileset dir="copernica/src" includes="**/*.jspm" />
		</jspm>
	</target>
	
	<target name="copernica.test.jspm" depends="jspm.taskdef">
		<jspm>
			<fileset dir="copernica/testsrc" includes="**/*.jspm" />
		</jspm>
	</target>
	
	<target name="copernica.test.compile"
				depends="lib.compile, lib.test.compile, copernica.compile, copernica.test.jspm">
		<mkdir dir="copernica/build/testclasses" />
		<ljavac srcdir="copernica/testsrc" destdir="copernica/build/testclasses">
			<classpath>
				<pathelement location="lib/build/classes" />
				<pathelement location="lib/build/testmodelclasses" />
				<pathelement location="copernica/build/classes" />
				<pathelement location="../cops/build/classes" />
				<pathelement location="../lib/junit.jar" />
				<pathelement location="../tomcat/common/lib/servlet-api.jar" />
			</classpath>
		</ljavac>
		<copy todir="copernica/build/testclasses/com/exedio/copernica">
			<fileset dir="copernica/testresources" />
		</copy>
	</target>
	
	<target name="copernica.testwebapp" depends="copernica.compile, copernica.test.compile">
		<foreachdb message="Using">
			<body>
				<mkdir dir="copernica/build/testwebapp-@{db}" />
				
				<copy todir="copernica/build/testwebapp-@{db}/WEB-INF/classes">
					<fileset dir="lib/build/classes" />
					<fileset dir="lib/build/testmodelclasses" />
					<fileset dir="copernica/build/classes" />
					<fileset dir="copernica/build/testclasses" />
					<fileset dir="../cops/build/classes" />
				</copy>
				
				<copy todir="copernica/build/testwebapp-@{db}/WEB-INF/lib">
					<fileset file="../lib/pcj.jar" />
					<fileset file="../lib/@{db.driver}" />
				</copy>
				
				<path id="webdatadir.@{db.file}.path">
					<pathelement location="copernica/build/testwebapp-@{db}-data" />
				</path>
				<pathconvert targetos="unix" property="webdatadir.@{db.file}" refid="webdatadir.@{db.file}.path" />
				
				<copy tofile="copernica/build/testwebapp-@{db}/WEB-INF/cope.properties"
						file="@{db.file}">
					<filterset>
						<filter token="DATADIR_PATH" value="${webdatadir.@{db.file}}" />
					</filterset>
				</copy>
				<copy todir="copernica/build/testwebapp-@{db}/WEB-INF/"
						file="copernica/web.xml" />
				<mkdir dir="copernica/build/testwebapp-@{db}-data" />
				<copy tofile="../tomcat/conf/Catalina/localhost/copetest-@{db}.xml"
						file="copernica/copetest.xml">
					<filterset>
						<filter token="DATABASE" value="@{db}" />
					</filterset>
				</copy>
				
				<touch file="copernica/build/testwebapp-@{db}/WEB-INF/web.xml" />
			</body>
		</foreachdb>
	</target>
	
	<target name="testwebapp" depends="copernica.testwebapp" />
	
	
	<target name="copernica.webtest.compile">
		<mkdir dir="copernica/build/webtestclasses" />
		<ljavac srcdir="copernica/webtestsrc" destdir="copernica/build/webtestclasses">
			<classpath>
				<fileset dir="../lib/jwebunit">
					<include name="*.jar" />
				</fileset> 
			</classpath>
		</ljavac>
	</target>
	
	<target name="copernica.webtest" depends="copernica.webtest.compile">
		<java classname="junit.textui.TestRunner" taskname="jwebunit"
				failonerror="yes" fork="yes">
			<classpath>
				<pathelement location="copernica/build/webtestclasses" />
				<fileset dir="../lib/jwebunit">
					<include name="*.jar" />
				</fileset> 
			</classpath>
			<arg value="com.exedio.copernica.PackageTest" />
		</java>
	</target>

	<target name="webtest" depends="copernica.webtest" />
	
	<target name="copernica" depends="copernica.compile" />
	
	<target name="dsmf.clean">
		<delete dir="dsmf/build" />
	</target>
	
	<target name="lib.clean">
		<delete dir="lib/build" />
	</target>

	<target name="instrument.clean">
		<delete dir="instrument/build" />
	</target>

	<target name="copernica.clean">
		<delete dir="copernica/build" />
		<delete>
			<fileset dir="copernica/src">
				<include name="**/*_Jspm.java" />
			</fileset>
			<fileset dir="copernica/testsrc">
				<include name="**/*_Jspm.java" />
			</fileset>
			<fileset dir="../tomcat/conf/Catalina/localhost">
				<include name="copetest-*.xml" />
			</fileset>
		</delete>
	</target>

	<target name="clean" depends="dsmf.clean, lib.clean, instrument.clean, copernica.clean" />
	
	
	<target name="api" depends="properties">

		<property name="api.private" value="off" />
		<property name="api.link.jdk"  value="http://java.sun.com/j2se/1.4.2/docs/api" />
		<property name="api.link.j2ee" value="http://java.sun.com/j2ee/1.4/docs/api" />
		<property name="api.link.junit" value="http://junit.sourceforge.net/javadoc" />
		<property name="api.link.ant"  value="http://searchmorph.com/pub/ant/apache-ant-1.6.2/build/javadocs" />

		<delete dir="api" />
		<mkdir  dir="api" />

		<javadoc
				destdir="api"
				maxmemory="60m"
				private="${api.private}"
				author="on"
				use="on"
				version="on"
				windowtitle="Cope with Object Persistence"
				splitindex="on"
				failonerror="true"
			>
			<doctitle><![CDATA[Cope with Object Persistence<br>API Specification]]></doctitle>
			<header>COPE</header>
			<footer><![CDATA[Cope with<br>Object<br>Persistence]]></footer>
			<bottom><![CDATA[<small>Copyright &copy; 2004-2005 <a href="http://www.exedio.com/" target="_top">exedio</a> Gesellschaft f&uuml;r Softwareentwicklung mbH. All rights reserved.</small><!--${label}-${cvstimestamp}-->]]></bottom>
			<link href="${api.link.jdk}"   packagelistLoc="package-list/jdk"   offline="true" />
			<link href="${api.link.j2ee}"  packagelistLoc="package-list/j2ee"  offline="true" />
			<link href="${api.link.junit}" packagelistLoc="package-list/junit" offline="true" />
			<link href="${api.link.ant}"   packagelistLoc="package-list/ant"   offline="true" />
			<link href="../../cops/api" />
			<fileset file="dsmf/src/com" includes="**/*.java" />
			<fileset file="lib/src/com" includes="**/*.java" />
			<fileset file="lib/patternsrc/com" includes="**/*.java" />
			<fileset file="lib/servletsrc/com" includes="**/*.java" />
			<fileset file="lib/junitsrc/com" includes="**/*.java" />
			<fileset file="instrument/src/com" includes="**/*.java" />
			<fileset file="copernica/src/com" includes="**/*.java" />
			<classpath>
				<pathelement location="../lib/pcj.jar" />
				<pathelement location="../lib/junit.jar" />
				<pathelement location="../tomcat/common/lib/ant.jar" />
				<pathelement location="../cops/build/classes" />
				<pathelement location="../tomcat/common/lib/servlet-api.jar" />
				<pathelement location="../tomcat/server/lib/commons-fileupload-1.0.jar" />
			</classpath>
			<group title="Cope Runtime Library" packages="com.exedio.cope:com.exedio.cope.*" />
			<group title="Copernica - Generic Backoffice" packages="com.exedio.copernica*" />
			<group title="Cope Instrumentor" packages="com.exedio.cope.instrument" />
			<group title="Database Schema Management Facility" packages="com.exedio.dsmf" />
		</javadoc>
	</target>

	<target name="jspm" depends="copernica.jspm, copernica.test.jspm" />
	
	<target name="all"
			depends="compile, test, jar, api,
						copernica.testwebapp,
						copernica.webtest.compile" />

</project>
